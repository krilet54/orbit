<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard — ORBIT Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <div class="noise-overlay"></div>

    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-header-left">
            <h1 class="admin-logo">ORBIT</h1>
            <span class="admin-badge">Admin</span>
        </div>
        <div class="admin-header-right">
            <span class="admin-user" id="adminUser">—</span>
            <button class="btn-logout" id="logoutBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
                Logout
            </button>
        </div>
    </header>

    <!-- Main Dashboard -->
    <main class="dashboard">
        <!-- Stats Bar -->
        <section class="stats-bar">
            <div class="stat-card">
                <span class="stat-number" id="totalSongs">0</span>
                <span class="stat-label">Total Songs</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="publishedSongs">0</span>
                <span class="stat-label">Published</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="draftSongs">0</span>
                <span class="stat-label">Drafts</span>
            </div>
        </section>

        <!-- Dashboard Content -->
        <div class="dashboard-grid">
            <!-- Library Section -->
            <section class="dashboard-section library-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 18V5l12-2v13"/>
                            <circle cx="6" cy="18" r="3"/>
                            <circle cx="18" cy="16" r="3"/>
                        </svg>
                        Song Library
                    </h2>
                    <div class="section-actions">
                        <button class="btn-refresh" id="refreshBtn" title="Refresh">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 4v6h-6M1 20v-6h6"/>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Songs Table -->
                <div class="table-container">
                    <table class="songs-table">
                        <thead>
                            <tr>
                                <th>Cover</th>
                                <th>Title</th>
                                <th>Theme</th>
                                <th>Summary</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="songsTableBody">
                            <tr class="loading-row">
                                <td colspan="6">
                                    <div class="loading-spinner"></div>
                                    Loading songs...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9 9h.01M15 9h.01M9 15c.5.5 1.5 1 3 1s2.5-.5 3-1"/>
                    </svg>
                    <p>No songs in the library yet.</p>
                    <span>Upload your first track to get started.</span>
                </div>
            </section>

            <!-- Upload Section -->
            <section class="dashboard-section upload-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Upload Song
                    </h2>
                </div>

                <form id="uploadForm" class="upload-form">
                    <!-- Audio File Upload -->
                    <div class="form-group">
                        <label class="form-label">Audio File</label>
                        <div class="file-upload" id="fileUploadArea">
                            <input 
                                type="file" 
                                id="audioFile" 
                                accept="audio/*" 
                                class="file-input"
                                required
                            >
                            <div class="file-upload-content">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                                <span class="file-upload-text" id="fileUploadText">
                                    Drop audio file or click to browse
                                </span>
                                <span class="file-formats">MP3, WAV, OGG, M4A</span>
                            </div>
                        </div>
                    </div>

                    <!-- Song Title -->
                    <div class="form-group">
                        <label for="songTitle" class="form-label">Song Title</label>
                        <input 
                            type="text" 
                            id="songTitle" 
                            class="form-input" 
                            placeholder="Enter song title"
                            required
                        >
                    </div>

                    <!-- Theme -->
                    <div class="form-group">
                        <label for="songTheme" class="form-label">Theme / Genre</label>
                        <input 
                            type="text" 
                            id="songTheme" 
                            class="form-input" 
                            placeholder="e.g., Synthwave • Nostalgia"
                        >
                    </div>

                    <!-- Cover Art Upload -->
                    <div class="form-group">
                        <label class="form-label">Cover Art (Optional)</label>
                        <div class="file-upload cover-upload" id="coverUploadArea">
                            <input 
                                type="file" 
                                id="coverFile" 
                                accept="image/*" 
                                class="file-input"
                            >
                            <div class="file-upload-content">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                    <polyline points="21 15 16 10 5 21"/>
                                </svg>
                                <span class="file-upload-text" id="coverUploadText">
                                    Drop cover image or click to browse
                                </span>
                                <span class="file-formats">JPG, PNG, WebP (Square recommended)</span>
                            </div>
                            <div class="cover-preview" id="coverPreview" style="display: none;">
                                <img id="coverPreviewImg" alt="Cover preview">
                                <button type="button" class="remove-cover" id="removeCover">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Summary -->
                    <div class="form-group">
                        <label for="songSummary" class="form-label">Summary</label>
                        <textarea 
                            id="songSummary" 
                            class="form-textarea" 
                            placeholder="Brief description of what the song is about..."
                            rows="3"
                        ></textarea>
                    </div>

                    <!-- Lyrics -->
                    <div class="form-group">
                        <label for="songLyrics" class="form-label">Lyrics</label>
                        <textarea 
                            id="songLyrics" 
                            class="form-textarea" 
                            placeholder="Enter lyrics (optional)"
                            rows="6"
                        ></textarea>
                    </div>

                    <!-- Published Toggle -->
                    <div class="form-group toggle-group">
                        <label class="form-label">Publish immediately</label>
                        <label class="toggle">
                            <input type="checkbox" id="publishToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <!-- Upload Progress -->
                    <div class="upload-progress" id="uploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <span class="progress-text" id="progressText">Uploading...</span>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn-primary btn-upload" id="uploadBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Upload Song
                    </button>
                </form>
            </section>
        </div>
    </main>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Song</h3>
                <button class="modal-close" id="modalClose">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <form id="editForm" class="edit-form">
                <input type="hidden" id="editSongId">
                <input type="hidden" id="editCurrentCoverUrl">
                
                <div class="form-group">
                    <label for="editTitle" class="form-label">Song Title</label>
                    <input type="text" id="editTitle" class="form-input" required>
                </div>

                <div class="form-group">
                    <label for="editTheme" class="form-label">Theme / Genre</label>
                    <input type="text" id="editTheme" class="form-input">
                </div>

                <!-- Cover Art in Edit Modal -->
                <div class="form-group">
                    <label class="form-label">Cover Art</label>
                    <div class="edit-cover-section">
                        <div class="current-cover" id="editCurrentCover">
                            <div class="cover-placeholder" id="editCoverPlaceholder">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                                </svg>
                            </div>
                            <img id="editCoverPreviewImg" alt="Current cover" style="display: none;">
                        </div>
                        <div class="cover-actions">
                            <label class="btn-secondary btn-small cover-upload-btn">
                                <input type="file" id="editCoverFile" accept="image/*" class="file-input">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                                Change Cover
                            </label>
                            <button type="button" class="btn-text btn-small" id="editRemoveCover">
                                Remove
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="editSummary" class="form-label">Summary</label>
                    <textarea id="editSummary" class="form-textarea" rows="3" placeholder="Brief description of the song..."></textarea>
                </div>

                <div class="form-group">
                    <label for="editLyrics" class="form-label">Lyrics</label>
                    <textarea id="editLyrics" class="form-textarea" rows="6"></textarea>
                </div>

                <div class="form-group toggle-group">
                    <label class="form-label">Published</label>
                    <label class="toggle">
                        <input type="checkbox" id="editPublished">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelEdit">Cancel</button>
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3 class="modal-title">Delete Song</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete "<span id="deleteSongTitle"></span>"?</p>
                <p class="warning-text">This action cannot be undone. The audio file will also be removed.</p>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" id="cancelDelete">Cancel</button>
                <button type="button" class="btn-danger" id="confirmDelete">Delete</button>
            </div>
            <input type="hidden" id="deleteSongId">
            <input type="hidden" id="deleteAudioUrl">
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span class="toast-message" id="toastMessage"></span>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Use runtime config so the anon key is injected from Vercel env -->
    <script src="/api/supabase-config.js"></script>
    <script src="admin.js"></script>
</body>
</html>
